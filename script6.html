<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>江月不渡 · 双女主情感本</title>
    <style>
        :root {
            --bg: #0f2623;
            --card-bg: #1c3630;
            --text: #efe6d7;
            --accent: #b35f4b;
            --primary: #5f8b7a;
            --secondary: #bd9b6b;
            --poem: #cfc1a6;
            --water: #34665c;
        }

        body { 
            font-family: 'STKaiti', 'KaiTi', 'SimSun', 'PingFang SC', serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            line-height: 1.8;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(52, 102, 92, 0.2) 0%, transparent 30%),
                repeating-linear-gradient(45deg, rgba(0,0,0,0.02) 0px, rgba(0,0,0,0.02) 2px, transparent 2px, transparent 6px);
        }
        
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .step-bar { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 30px; 
            background: rgba(28, 54, 48, 0.8); 
            padding: 12px; 
            border-radius: 40px; 
            font-size: 0.95rem; 
            border: 1px solid var(--secondary);
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .step { 
            color: #aabfb7; 
            transition: 0.3s; 
            padding: 8px 18px;
            border-radius: 30px;
            background: transparent;
            position: relative;
            z-index: 1;
            font-weight: 400;
            letter-spacing: 1px;
        }
        
        .step.active { 
            color: #f5ecd9; 
            font-weight: bold; 
            background: var(--primary);
            box-shadow: 0 0 15px rgba(95, 139, 122, 0.6);
            border: 1px solid var(--secondary);
        }

        .card { 
            background: rgba(28, 54, 48, 0.9); 
            padding: 30px; 
            border-radius: 24px; 
            box-shadow: 0 20px 40px rgba(0, 20, 10, 0.8); 
            min-height: 500px; 
            border: 1px solid var(--secondary);
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--secondary), var(--primary), var(--water));
        }
        
        h1, h2 { 
            color: var(--secondary); 
            text-align: center; 
            margin-bottom: 25px;
            text-shadow: 2px 2px 8px rgba(0, 30, 20, 0.8);
            font-family: 'STKaiti', serif;
            position: relative;
            padding-bottom: 15px;
            letter-spacing: 3px;
        }
        
        h1::after, h2::after {
            content: '⏤⏤⏤⏤';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            color: var(--secondary);
            opacity: 0.5;
            font-weight: normal;
            font-size: 1.2rem;
        }
        
        .game-title {
            color: var(--poem);
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 30px;
            font-style: italic;
            padding: 20px;
            border: 1px dashed var(--primary);
            border-radius: 60px;
            background: rgba(95, 139, 122, 0.1);
            line-height: 2;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        
        .poem {
            font-family: 'STKaiti', serif;
            color: var(--poem);
            font-size: 1rem;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid var(--primary);
            border-right: 4px solid var(--primary);
            background: rgba(0, 30, 20, 0.3);
            border-radius: 100px;
        }
        
        .script-text { 
            white-space: pre-wrap; 
            background: #132a24; 
            padding: 25px; 
            border-radius: 30px; 
            border: 1px solid var(--secondary); 
            margin-top: 20px; 
            font-size: 1rem; 
            text-align: justify; 
            line-height: 1.9;
            max-height: 550px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #132a24;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.6);
        }
        
        .script-text::-webkit-scrollbar {
            width: 6px;
        }
        
        .script-text::-webkit-scrollbar-track {
            background: #132a24;
            border-radius: 10px;
        }
        
        .script-text::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 10px;
            border: 1px solid var(--secondary);
        }

        .clue-grid { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 18px; 
            margin-top: 20px; 
        }
        
        @media (min-width: 600px) {
            .clue-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .clue-card { 
            background: #1d423a; 
            padding: 22px; 
            border-radius: 20px; 
            font-size: 0.95rem; 
            border-left: 6px solid var(--primary);
            transition: all 0.2s;
            box-shadow: 0 8px 0 #0b2a24;
            border-bottom: 2px solid var(--secondary);
        }
        
        .clue-card:hover {
            transform: translateY(-3px);
            background: #23544a;
            box-shadow: 0 10px 0 #0b2a24;
        }
        
        .clue-card .clue-number {
            display: inline-block;
            background: var(--primary);
            color: #132a24;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            margin-right: 14px;
            font-weight: bold;
            font-family: 'STKaiti', serif;
            font-size: 1.1rem;
        }

        select, input { 
            width: 100%; 
            padding: 14px; 
            margin: 12px 0; 
            background: #1b3d35; 
            border: 1px solid var(--secondary); 
            color: var(--text); 
            border-radius: 30px; 
            box-sizing: border-box; 
            font-size: 1rem;
            font-family: 'STKaiti', serif;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--poem);
            box-shadow: 0 0 0 3px rgba(95, 139, 122, 0.4);
        }
        
        button { 
            background: linear-gradient(145deg, var(--primary), #2b6b5c); 
            color: #f5f0e0; 
            border: none; 
            padding: 16px; 
            border-radius: 40px; 
            cursor: pointer; 
            width: 100%; 
            font-size: 1.1rem; 
            margin-top: 20px; 
            transition: 0.2s; 
            font-weight: bold;
            letter-spacing: 3px;
            font-family: 'STKaiti', serif;
            box-shadow: 0 10px 0 #1e4b40, 0 4px 20px rgba(0,0,0,0.3);
        }
        
        button:hover { 
            background: linear-gradient(145deg, #3f8875, var(--primary)); 
            transform: translateY(-2px);
            box-shadow: 0 12px 0 #1e4b40, 0 8px 25px rgba(0,0,0,0.4);
        }
        
        .btn-secondary { 
            background: linear-gradient(145deg, #4d665e, #2b4a41);
            box-shadow: 0 8px 0 #1e332e;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(145deg, #63877b, #3f665b);
        }

        .hidden { 
            display: none; 
        }
        
        .warning { 
            color: #e6b89c; 
            font-size: 0.9rem; 
            margin-top: 20px; 
            text-align: center; 
            padding: 15px;
            background: rgba(179, 95, 75, 0.15);
            border-radius: 40px;
            border-left: 4px solid var(--accent);
        }
        
        .truth-box {
            background: linear-gradient(145deg, #1f4038, #17322b);
            border: 1px solid var(--secondary);
            padding: 25px;
            border-radius: 30px;
            margin: 25px 0;
            box-shadow: inset 0 0 15px #0e2620;
        }
        
        .role-tag {
            display: inline-block;
            background: var(--primary);
            color: #132a24;
            padding: 6px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            margin-right: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--secondary);
            font-weight: bold;
        }
        
        .task-box {
            background: rgba(95, 139, 122, 0.2);
            border-left: 6px solid var(--secondary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 20px;
            font-size: 0.95rem;
        }
        
        .task-box h4 {
            color: var(--secondary);
            margin-top: 0;
            font-family: 'STKaiti', serif;
            font-size: 1.2rem;
        }
        
        .player-info {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--primary);
        }
        
        .secret-box {
            background: rgba(179, 95, 75, 0.1);
            border: 1px dashed var(--accent);
            padding: 18px;
            margin: 15px 0;
            border-radius: 20px;
        }
        
        .secret-title {
            color: var(--accent);
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }
        
        .password-box {
            background: rgba(26, 55, 46, 0.9);
            border: 2px solid var(--accent);
            border-radius: 40px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            backdrop-filter: blur(4px);
        }
        
        .password-box h4 {
            color: var(--accent);
            margin-bottom: 15px;
            font-family: 'STKaiti', serif;
        }
        
        .password-input {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        
        .password-input input {
            flex: 1;
            text-align: center;
            font-size: 1.1rem;
            background: #1e453c;
            border-radius: 40px;
            border: 1px solid var(--secondary);
        }
        
        .password-input button {
            width: auto;
            padding: 14px 30px;
            margin-top: 0;
        }
        
        .password-hint {
            font-size: 0.85rem;
            color: var(--poem);
            margin-top: 12px;
            font-style: italic;
        }
        
        .snowflake {
            position: fixed;
            color: rgba(207, 193, 166, 0.2);
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 1000;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- 步骤导航 -->
    <div class="step-bar">
        <span id="step1" class="step active">一 · 择舟</span>
        <span id="step2" class="step">二 · 阅江</span>
        <span id="step3" class="step">三 · 寻痕</span>
        <span id="step4" class="step">四 · 渡月</span>
    </div>

    <!-- 第一步：选择身份 -->
    <div id="view1" class="card">
        <h1>江月不渡</h1>
        <div class="game-title">
            ～～ 渡口边，茶蛋香，一只鞋，两个人 ～～<br>
            阿桂的船篙撑得起一江寒水，撑不起阿宁藏起的绣花。<br>
        </div>
        
        <div class="poem">
            江边月，照两人<br>
        </div>
        
        <div class="player-info">
            <label>你的名字：</label>
            <input type="text" id="player-name" placeholder="请输入你的昵称" value="渡客">
            
            <label>选择你的命缘：</label>
            <select id="role-select"></select>
            
            <div style="margin-top: 25px;">
                <span class="role-tag">双女主·情感沉浸</span>
            </div>
        </div>
        
        <button onclick="toStep2()">踏入江边雾色</button>
        
        <div class="warning">
            ⚠️ 请与搭档一同阅读，每幕结束后交流感受。<br>
           预计游戏时间：1.5小时
        </div>
    </div>

    <!-- 第二步：分幕剧本 -->
    <div id="view2" class="card hidden">
        <h2 id="display-role-name">阿桂 · 撑船女</h2>
        
        <div class="task-box">
            <h4>🎋 你的命缘</h4>
            <div id="display-tasks">你叫阿桂，嗓门大，心里装着一船人的重量。</div>
        </div>
        
        <div class="secret-box">
            <div class="secret-title">心底事</div>
            <div id="display-secrets">——</div>
        </div>
        
        <!-- 分幕切换控件 -->
        <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin: 15px 0;">
            <button id="prevActBtn" class="btn-secondary" style="width: auto; padding: 8px 25px;" onclick="prevAct()">◀ 上一幕</button>
            <span id="actIndicator" style="color: var(--poem); font-size: 1.1rem;">第一幕 / 共三幕</span>
            <button id="nextActBtn" class="btn-secondary" style="width: auto; padding: 8px 25px;" onclick="nextAct()">下一幕 ▶</button>
        </div>
        
        <!-- 剧本显示区 -->
        <div class="script-text" id="display-script">正在加载江边故事...</div>
        
        <button onclick="toStep3()">我已读完第三幕，去寻线索</button>
        <button class="btn-secondary" onclick="toStep1()">重选角色</button>
    </div>

    <!-- 第三步：线索查探 -->
    <div id="view3" class="card hidden">
        <h2>🌿 物语 · 痕迹</h2>
        <div class="poem">
            茶摊的灰烬里，藏着一只鞋；<br>
            陈婆的木匣中，叠着三张纸。
        </div>
        
        <!-- 公共线索网格 -->
        <div id="clue-grid" class="clue-grid"></div>
        
        <button onclick="toStep4()">我已看清，渡向结局</button>
        <button class="btn-secondary" onclick="toStep2()">返回命缘</button>
    </div>

    <!-- 第四步：最终裁决 -->
    <div id="view4" class="card hidden">
        <h1 style="color: var(--secondary);">⚖️ 江底沉冤</h1>
        <div class="poem">
            陈婆手里的那只鞋，究竟是谁的罪？<br>
            投下你的判断，让江月照亮归途。
        </div>
        
        <div class="truth-box">
            <h3 style="color: var(--secondary);">指认真凶</h3>
            <p style="font-size: 0.95rem; margin-bottom: 20px; text-align: center;">
                茶摊的三个影子——刘屠夫、周老板娘、货郎，谁的手染了陈婆的血？
            </p>
            
            <label>真正的凶手是？</label>
            <select id="vote-murderer">
                <option value="">请选择...</option>
                <option value="刘屠夫">刘屠夫</option>
                <option value="周老板娘">周老板娘</option>
                <option value="货郎">货郎</option>
            </select>
            
            <button onclick="submitVote()">确认指认</button>
        </div>
        
        <!-- 密码解锁区域 -->
        <div id="password-section" class="password-box hidden">
            <h4>🔐 密码解锁</h4>
            <p style="color: var(--text); margin-bottom: 15px;">
                请输入与本案最痛的记忆相关的文字<br>
                <span style="font-size: 0.85rem; color: var(--poem);">（陈婆最后留下的念想）</span>
            </p>
            
            <div class="password-input">
                <input type="text" id="truth-password" placeholder="一个字" maxlength="20">
                <button onclick="verifyPassword()">验证</button>
            </div>
            
            <div class="password-hint">
                提示：陈婆给阿生做的，只有一只，后来找到了……
            </div>
        </div>
        
        <!-- 真相与结局 -->
        <div id="truth-content" class="hidden" style="margin-top: 30px;">
            <h3 style="color: var(--secondary);">沉底的真相</h3>
            <div class="script-text" id="display-truth" style="border-color: var(--primary);"></div>
            
            <h3 style="color: var(--secondary); margin-top: 30px;">江月不渡 · 终章</h3>
            <div id="display-ending" class="script-text" style="border-color: var(--secondary);"></div>
            
            <button class="btn-secondary" onclick="location.reload()" style="margin-top: 25px;">重历江边</button>
        </div>
    </div>
</div>

<script>
    // 雪花氛围 (江月飘絮)
    function createFlakes() {
        const flakes = ['☁', '🌙', '·', '。', '✧'];
        for (let i = 0; i < 15; i++) {
            setTimeout(() => {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = flakes[Math.floor(Math.random() * flakes.length)];
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.fontSize = (Math.random() * 18 + 12) + 'px';
                flake.style.opacity = Math.random() * 0.3 + 0.1;
                flake.style.animationDuration = (Math.random() * 12 + 12) + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(flake);
                setTimeout(() => flake.remove(), 20000);
            }, i * 200);
        }
    }

    // ========== 剧本核心配置 ==========
    const CONFIG = {
        title: "江月不渡",
        password: "鞋",   // 密码
        roles: {
            "agui": {
                name: "阿桂 · 撑船女",
                tasks: "你叫阿桂，嗓门大，笑起来有虎牙。你心里装着一船人的重量，却不知有人为你沉在江底。",
                secrets: "——",
                scripts: [
                    // 第一幕
                    `【第一幕 · 江边日常】

【序幕 · 那年】

你叫阿桂，在这清江渡口撑了五年的船。

爹还在的时候，这条船是爹撑的。爹的嗓门大，喊一嗓子，对岸都能听见：“过江咯——三文一位，童叟无欺——”后来爹没了，你就接过那根竹篙，学着爹的样子喊。一开始声音抖，喊出来像猫叫。现在好了，你喊一嗓子，对岸的狗都跟着叫。

你有个弟弟叫阿生，今年十岁。爹走那年他才五岁，趴在棺材上哭，哭累了就在你怀里睡着，口水流了你一袖子。你那时候就想，这辈子得把这小子拉扯大，让他吃饱穿暖，最好能识几个字，别像你，连自己名字都写得歪歪扭扭。

渡口边上有间茶摊，卖茶蛋的，摊主是个老婆子，都叫她陈婆。陈婆的茶蛋香，卤了一夜，壳都裂了纹，剥开全是酱色。爹在的时候，陈婆常给爹送茶蛋，不收钱。爹没了，陈婆就给你送，还是不收钱。你推，她就瞪眼：“你爹当年救我儿子一命，我还没还够呢！”

你不知道这事，爹从没说过。但陈婆每次这么说，你就不知道该推了。

日子就这么过着，撑船，接人，送人，回家给阿生做饭。有时候觉得累，有时候也不觉得。江风把脸吹糙了，手上有茧子，但阿生一天天长高，你就觉得值。

直到那天早上。

【第一场 · 渡口】

天还没亮透，江面上飘着薄雾，像一层撕不烂的旧纱布。

你把船拴好，照例朝对岸喊：“阿宁——今天风大，多穿点——”

回声在雾里闷闷地滚了几滚。等了一会儿，雾里走出一个瘦瘦的影子，裹着那件洗得发青的旧斗篷，怀里抱着个布包，热腾腾地冒着气。

阿宁。镇上绣坊的学徒，和你同年，打小就认识。你爹救过她爹，两家就这么走动起来。她娘手紧，但逢年过节总要匀出一碗腊肉让她带过江来。你呢，每月逢三逢八她上工的日子，撑船送她，分文不收。

阿宁走到船边，把布包递给你：“桂花糕。我娘说你家阿生长身体，这个顶饿。”

你接过来，往怀里一揣，腾出手扶她上船。船晃了晃，她下意识抓住你的袖子，抓得紧紧的。

你笑：“抓这么紧，怕我把你扔江里啊？”

阿宁不说话。你侧头看她，她的脸在斗篷帽子里显得更小了，下巴尖尖的，嘴唇没什么血色。你想说点什么，又不知道该说什么。她从小就这样，话少，你习惯了。

船到对岸，她下船，走了几步，又回头。

“阿桂。”

“嗯？”

“下午我去接阿生放学，你别跑空了。”

你愣了一下。往常都是你去接，阿生那小子皮，不盯着能窜到江里去。但阿宁这么说，你就点点头：“行，那我去绣坊找你。”

阿宁没应，转身走了。那件青斗篷在雾里一颠一颠的，越走越远。

【第二场 · 绣坊的窗】

下午，你送完一趟货，拐去绣坊。

绣坊是个二层小楼，楼下卖绣品，楼上做工。老板娘姓周，四十来岁，脸总是绷着，但人其实不坏。你站在门口往里看，没看见阿宁。

“找阿宁？”周氏从柜台后头探出脑袋，“楼上呢。别上去啊，一屋子料子，你那脚底板都是泥。”

你就没上去，绕到后院，蹲在阿宁那扇窗底下。

窗户半开着，能看见阿宁低着头，细细地绣。阳光从窗格子里漏进去，落在她的针尖上，亮晶晶的。她的动作很慢，每绣几针就要停一停，揉揉手腕。

你蹲在窗根底下，从兜里摸出一把瓜子，嗑起来。壳摆成一排，整整齐齐。

“你烦不烦？”阿宁头也不抬。

“不烦。”你吐掉瓜子皮，“你绣你的，我蹲我的。咱俩各干各的，谁也不碍谁。”

阿宁的嘴角动了动，没说话。针脚还是那么密，那么齐。

过了一会儿，她忽然说：“阿生今天在学校被先生夸了。”

“夸什么？”

“字写得好。先生说他有天分，该供着念书。”

你手里的瓜子停了停。供着念书，那是要钱的。你撑船一个月挣的，只够吃饭吃药，哪来的钱供念书。

阿宁像是知道你在想什么，没再说下去。

你继续嗑瓜子，壳又摆成一排。

【第三场 · 半夜的敲门声】

那天夜里，阿生病了。

咳嗽，发烧，喘不上气。小小的身子在被子里缩成一团，脸烧得通红，嘴里嘟囔着胡话。你急得手都在抖，把凉帕子敷在他额头上，一遍遍地换，不见好。

你冲出家门，把船撑得飞快，过江去敲阿宁家的门。

阿宁开门的时候，脸上还带着睡意，看见你的脸，什么也没问，转身回去披上衣服就跟着走。她娘在后头喊：“你那身子骨，夜里风大，吹出病来怎么办！”

阿宁没回头。

那一夜，阿宁守在阿生床边，一遍遍用凉帕子给他敷额头。你蹲在门槛上，把脸埋进膝盖里，肩膀一抖一抖的。

天快亮的时候，阿生退了烧。阿宁站起来，晃了晃，扶住墙。

你抬头看她，眼睛红红的。

阿宁说：“没事。我去绣坊了，今天有批货要交。”

她走了。那件青斗篷在晨雾里一颠一颠的，像一片随时会被风吹走的叶子。

你看着她的背影，忽然觉得哪里不对。她的脚步比平时慢，肩膀也塌着，走几步就要歇一歇。

但你没问。阿宁不想说的事，你从来不问。

【第一幕完】

请与对方交流此刻的感受。
在你的记忆里，阿宁是个什么样的人？用三个词形容。

你觉得阿宁对你好吗？有没有哪件事让你特别感动？

你觉得自己亏欠阿宁吗？如果有，是什么？`,
                    // 第二幕
                    `【第二幕 · 暗流】

【第四场 · 一个月后】

阿生的病没好利索，断断续续地咳。大夫说，得用一味药引子——三年的陈艾，端午那天采的，晒足一百天，再用霜降后的井水泡。

你没有。这玩意儿贵，买不起。你问过几个药铺，最便宜的也要三十两。三十两，你撑一年船都攒不下来。

你只能给他熬些止咳的偏方，喝了也不见好，咳起来还是一阵一阵的。阿生懂事，咳完了就对你笑：“姐，我没事，不难受。”你听了，心里像被针扎。

那天你去接阿宁下工，发现她站在绣坊门口，脸色比平时更白。白的像纸，嘴唇都没什么颜色。你问她怎么了，她说没事，站久了，累。

你想多问几句，她已经上了船，把那件青斗篷裹得紧紧的。

回程的路上，她一直攥着袖子，不松手。你没在意，以为她冷。

又过了几天，你去绣坊送鱼，听见老板娘在骂人：“绣坏了！眼睛长哪儿去了！这料子你赔得起吗！”

你探头一看，被骂的是阿宁。

她低着头，站在那儿，一动不动。老板娘的声音尖利，一句一句扎过去，她就像听不见一样。

你想冲进去，阿宁忽然抬头，看了你一眼。很轻地摇了摇头。

你就站住了。站在门口，看着阿宁被骂完，看着阿宁默默地收拾那些废掉的料子，看着阿宁把一锭银子放在柜台上。

那锭银子，白花花的，在柜台上滚了滚，停住。

你认得那锭银子。阿宁攒了三年，想给自己赎身的。她说过，等攒够了钱，就不在绣坊干了，回家开个小铺子，卖绣品，自由自在。

现在那锭银子，在周老板娘手里了。

你不明白。但她不说，你就不问。

【第五场 · 陈婆的茶蛋】

陈婆最近总给你送茶蛋。送得比以前还勤，每次都说：“给阿生的，那孩子瘦了，得多补补。”

你推辞，她就瞪眼：“你爹当年救我儿子一命，我还没还够呢！”

你不知道她儿子是谁，也从没见过。但陈婆这么说，你就不再推。

那天陈婆又来送茶蛋，手里还拿着个布包。她神神秘秘地塞给你：“这个给阿生。”

你打开一看，是一只鞋。小孩的鞋，新做的，针脚细细密密，鞋面上还绣着一朵小小的桂花。

“陈婆……”

“别说话。”陈婆摆摆手，“我做的，阿生穿肯定合适。还有一只，做好了再给你。”

你鼻子一酸，想说谢谢，她已经走了。佝偻着背，走得慢慢的，背影越来越远。

你把那只鞋攥在手里，攥了很久。

【第二幕完】

请与对方交流此刻的感受。
阿宁最近有什么变化？你注意到了吗？

你觉得阿宁为什么要把赎身的钱赔给老板娘？

陈婆对你好吗？你有没有想过要回报她？`,
                    // 第三幕
                    `【第三幕 · 惊雷】

那天早上，有人在渡口边上的茶摊发现了陈婆。

她倒在地上，后脑勺磕在灶台角上，血流了一地，已经凉透了。

她手里紧紧攥着一只鞋。小孩的鞋，新做的，鞋面上绣着一朵小小的桂花。只有一只。

茶摊里没有打斗的痕迹，灶上的茶蛋还热着，锅里咕嘟咕嘟冒着热气。

你站在陈婆的茶摊前，看着那只鞋。

新做的，绣着一朵桂花，只有一只。

你想起那天陈婆把鞋塞给你，神神秘秘地说：“还有一只，做好了再给你。”

她没给。

她死了。

你想起她每次送茶蛋的样子，佝偻着背，慢慢走来，把热腾腾的蛋塞进你手里。
你想起她说：“你爹当年救我儿子一命，我还没还够呢。”
你不知道她儿子是谁，也从没见过。你只知道，她一直在还，一直在还，还到现在，把自己还没了。

你蹲下来，把那只鞋放在灶台边上。

忽然，你想起了什么。

那张药铺的收据。三年陈艾，三十两。付清了。
付清的那天，是七天前。
而七天前，阿宁刚刚把赎身的钱赔给老板娘。

你站起来，手开始抖。

你想起阿宁那些苍白的脸，那些攥紧的袖子，那些“没事”，那些“站久了”。
你想起她半夜从被窝里爬起来，跟你过江去照顾阿生，然后在晨雾里摇摇晃晃地走远。
你想起她蹲在阿生床边，一遍遍地敷帕子，手冻得通红，也没吭一声。

你想起了那锭银子。
那锭她攒了三年、想给自己赎身的银子。
那锭她赔给老板娘、让你百思不得其解的银子。

现在你知道了。

阿宁。

你把嘴捂住，不让自己哭出声。

【第三幕完】

请与搭档交流后，前往线索查探。`
                ]
            },
            "aning": {
                name: "阿宁 · 绣娘",
                tasks: "你叫阿宁，身子弱，话少。你的针脚密密匝匝，像你把所有话都缝进了布里。",
                secrets: "——",
                scripts: [
                    // 第一幕
                    `【第一幕 · 江边日常】

【序幕 · 那年】

你叫阿宁，在镇上绣坊做学徒，今年是第四年。

绣坊的活不累，就是费眼睛。一坐一整天，低着头，盯着针脚，绣完了花绣叶子，绣完了叶子绣云纹。你眼睛好，手也稳，周老板娘说你有天分，再学两年就能出师。

你娘不这么想。她总说，姑娘家学这些有什么用，早点嫁人才是正经。你不吭声，她就叹气，叹完气继续纳鞋底，纳得针脚密密匝匝。

你爹走得早，是你娘把你拉扯大的。你娘命苦，你爹走的那年她才三十出头，硬是没改嫁，一个人撑到现在。你知道她为你操碎了心，所以她说嫁人，你不顶嘴；她说别和阿桂走太近，你也不顶嘴。但该走多近，你心里有数。

阿桂。你打小就认识她。

那年你爹落水，是她爹救的。人救上来了，她爹病了半个月，差点没挺过去。你娘拎着鸡蛋去谢，她爹躺在床上摆摆手：“乡里乡亲的，说这些干啥。”你那时候才七岁，站在门口往里看，看见一个扎着冲天辫的小姑娘，正蹲在床边给她爹喂药。她喂一勺，洒半勺，她爹也不恼，就那么笑眯眯地看着。

后来她爹没了。你娘听说这事，沉默了很久，然后去柜子里翻出一块腊肉，让你送过江去。

那是你第一次一个人坐船。你站在渡口等，等了好久，才看见一条船从雾里撑出来。撑船的就是那个扎冲天辫的小姑娘，她长高了，辫子没了，换成一根随便挽着的发髻，脸上有风刮出来的皴。

她看见你，愣了一下，然后笑了，露出一颗小虎牙。

“你是对岸那个？”

你点点头。

“来找我？”

你又点点头。

她笑得更大了，伸手把你拉上船：“走，带你去我家吃肉。”

那是你们第一次说话。

从那以后，你就常去。送腊肉，送鸡蛋，送她娘腌的咸菜。每次去，她都把你按在桌边，非要留你吃饭。她家穷，饭桌上没什么好东西，一碗糙米，一碟咸菜，有时候能有一筷子腊肉，都夹到你碗里。

你娘说你傻，人家穷成那样，你去一趟人家就得破费一顿。你不吭声，下次还是去。

你不图那顿饭。你就喜欢看她吃饭的样子，腮帮子鼓鼓的，一边嚼一边说话，话说得含含糊糊，你听不懂，但觉得热闹。

后来你去绣坊做学徒，不能常去了。但每个月逢三逢八，你要去镇上上工，她撑船送你，分文不收。你给她钱，她就瞪眼：“收你钱？我爹在底下能托梦骂我。”

你就把钱收回去，改带东西。桂花糕、花生糖、有时候是几个橘子，都塞给她。

她也不推，接过就往怀里揣，揣得鼓鼓囊囊的。

日子就这么过着。

直到那天早上。

【第一场 · 渡口】

天还没亮透，江面上飘着薄雾。

你娘起得早，在灶房里蒸桂花糕，蒸汽把窗户糊成一片白。你坐在门槛上，把那件旧斗篷裹紧，等着。

“阿宁。”你娘在灶房里喊，“把这糕给阿桂送去，她家阿生长身体，这个顶饿。”

你应了一声，接过布包，往渡口走。

雾很大，路边的草叶子上都是露水，把你的鞋面打湿了。你走得不快，走几步就要歇一歇，胸口闷闷的，像压了块石头。

昨天又绣到半夜，周老板娘催得紧，那批货月底要交。你绣得慢，因为手抖，针总是拿不稳。周老板娘骂了你几句，你没吭声。她不知道你手抖是因为没吃饭，你不知道怎么开口。

走到渡口，远远就看见那条船，还有船上那个站着的人。她把竹篙插在水里，手搭在嘴边，朝这边喊：“阿宁——今天风大，多穿点——”

声音在雾里传得很远。

你忍不住弯了弯嘴角。这个傻子，喊这么大声，对岸的狗又要叫了。

你走过去，把布包递给她：“桂花糕。我娘说你家阿生长身体，这个顶饿。”

她接过去，往怀里一揣，腾出手扶你上船。船晃了晃，你下意识抓住她的袖子，抓得紧紧的。她的袖子有股皂角的味道，还有江水的腥气，你闻着，忽然觉得胸口那块石头轻了一点。

她笑：“抓这么紧，怕我把你扔江里啊？”

你不说话，只是把袖子攥得更紧。

船到对岸，你下船，走了几步，又回头。

“阿桂。”

“嗯？”

“下午我去接阿生放学，你别跑空了。”

她愣了一下，然后点头：“行，那我去绣坊找你。”

你没应，转身走了。

你不敢应。因为你知道，你去接阿生，不是为了省她的事，是因为你想多看阿生几眼。那孩子越长越像阿桂，虎头虎脑的，笑起来也有一颗小虎牙。你每次看见他，就会想起那年站在门口往里看的扎冲天辫的小姑娘。

【第二场 · 绣坊楼上】

下午，你在楼上绣花。

阳光从窗格子里漏进来，落在针尖上。你绣得很慢，每绣几针就要停一停，揉揉手腕。手腕酸，肩膀也酸，胸口那口气总是提不上来。

周老板娘在楼下骂人，骂一个新来的学徒。你听着，手上不停。

忽然，窗户底下传来嗑瓜子的声音。

你低头一看，就看见窗根底下蹲着一个人，背对着你，正把瓜子壳摆成一排。摆得整整齐齐，像在搞什么仪式。

你忍不住开口：“你烦不烦？”

她头也不回：“不烦。你绣你的，我蹲我的。咱俩各干各的，谁也不碍谁。”

你想笑，但忍住了。你把针脚绣得密密匝匝，偶尔抬头看她一眼。她一直蹲着，一直嗑，一直摆，像个傻子。

过了一会儿，你忽然想说点什么。

“阿生今天在学校被先生夸了。”

“夸什么？”

“字写得好。先生说他有天分，该供着念书。”

她没接话。你知道她在想什么。钱。供着念书要钱。她没有。

你没再说什么。有些话，说出来也没用，还不如不说。

【第三场 · 半夜的敲门声】

那天半夜，门被敲响了。

你娘去开门，然后就听见她的声音，哑哑的，带着哭腔：“阿宁……阿生病了……求你……”

你没等她喊完，已经披上衣服冲了出去。

她站在门口，脸上全是泪，手在抖。你从来没见她这样过，她平时嗓门那么大，笑起来虎牙都露出来，现在却像个孩子一样缩着肩膀，无助地看着你。

你什么也没说，跟着她走。

那一夜，你守在阿生床边，一遍遍用凉帕子给他敷额头。她蹲在门槛上，把脸埋进膝盖里，肩膀一抖一抖的。

你想说点什么，但胸口太闷了，闷得说不出话来。你只能继续敷，一遍一遍，直到阿生的烧退下去。

天快亮的时候，你站起来，眼前一黑，扶住了墙。

她抬头看你，眼睛红红的。

你说：“没事。我去绣坊了，今天有批货要交。”

你走了。

走出去的时候，你感觉自己的脚步是飘的，像踩在棉花上。胸口那口气越来越提不上来，你知道自己该歇一歇，但你不能歇。那批货月底要交，周老板娘催得紧，你绣得慢，不能再歇了。

你不知道的是，你走后，她一直看着你的背影，看着你在晨雾里一颠一颠的，像一片随时会被风吹走的叶子。

她看着，忽然觉得哪里不对。

但她没问。你不想说的事，她从来不问。

【第一幕完】

请与对方交流此刻的感受。
在你的记忆里，阿桂是个什么样的人？用三个词形容。

你觉得阿桂对你好吗？有没有哪件事让你特别感动？

你觉得自己亏欠阿桂吗？如果有，是什么？`,
                    // 第二幕
                    `【第二幕 · 暗流】

【第四场 · 一个月前】

你做了一个决定。

阿生的病需要三年陈艾，三十两银子。阿桂没有，你也没有。但你知道一个办法——绣血绣。

血绣是一种邪门的绣法，用绣娘的心头血染线，绣出的花样能在夜里发光，驱邪避煞。镇上有个贩子专门收这个，出价高，一尺十两。但每绣一寸，要歇三天；绣完一尺，要病半年。绣到最后，人会废掉。

你去找了那个贩子。他看了你一眼，说：“姑娘，你身子骨不行，别绣了。”

你说：“我能绣。”

他沉默了一会儿，说：“三尺的驱煞图，三十两。一个月交。死了我不负责。”

你点点头。

从那以后，你每天绣到半夜。绣之前，用针扎破指尖，把血滴进线里。一开始疼，后来就不疼了，手指上全是针眼，密密麻麻的。你娘看见了，问你，你说是不小心扎的。她信了，叹着气给你上药。

你不知道的是，你绣血绣的时候，有个人一直在看着你。

陈婆。

那天她来镇上买东西，路过绣坊后院，从窗户里看见你低着头，一针一针地绣。她看了很久，然后走了。

第二天，她来找你，在渡口边上的茶摊。

“阿宁。”她叫你。

你抬头，看见她站在那儿，手里拿着两个茶蛋。

“吃。”她把茶蛋塞给你，“补补身子。”

你没敢要。你怕她看出什么。

但她什么都没说。只是坐在你旁边，絮絮叨叨地说些闲话，说阿桂小时候的事，说阿生有多可爱，说她那只老母鸡今天下了两个蛋。

你听着，忽然觉得心里有什么东西松了一点。

后来她就常来。每次来都带茶蛋，都坐在你旁边絮叨。你知道她是故意来的，你知道她看见了你绣血绣，但她不说，你也不说。

你只是每次看见她佝偻着背走远，心里都会想：等绣完这幅图，拿了银子，一定给陈婆买件新衣裳。

你不知道的是，陈婆也在做一件事。

【第五场 · 陈婆的秘密】

陈婆在攒钱。

她没什么钱，卖茶蛋一天挣不了几文。但她攒着，一文一文地攒，攒了很久。

那天她去了一趟对岸，去了周家药铺。

“老板，三年陈艾，有吗？”

“有，三十两。”

她点点头，走了。

回去的路上，她一直在算。自己攒了多少，还差多少。算来算去，还差十五两。

她站在渡口边上，看着那条船，看了很久。

那条船上，阿桂正在撑篙，喊着：“过江咯——三文一位，童叟无欺——”

陈婆忽然笑了。

这丫头，喊得比她爹还响。

【第二幕完】

请与对方交流此刻的感受。
你为什么要绣血绣？值得吗？

陈婆有没有对你说过什么特别的话？

你觉得阿桂知道你在做什么吗？`,
                    // 第三幕
                    `【第三幕 · 惊雷】

那天早上，有人在渡口边上的茶摊发现了陈婆。

她倒在地上，后脑勺磕在灶台角上，血流了一地，已经凉透了。

她手里紧紧攥着一只鞋。小孩的鞋，新做的，鞋面上绣着一朵小小的桂花。只有一只。

茶摊里没有打斗的痕迹，灶上的茶蛋还热着，锅里咕嘟咕嘟冒着热气。

你站在陈婆的茶摊前，看着那只鞋。

新做的，绣着一朵桂花，只有一只。

你见过这只鞋。那天陈婆坐在你旁边絮叨，手里就在纳这只鞋。她纳得很慢，每一针都要眯着眼睛看半天，然后笑着说：“老了，眼睛不中用了。”

她说这是给阿生做的。阿生的鞋磨破了，该换新的。

她问你：“阿宁，你说这鞋面上绣朵什么好？”

你说：“绣桂花吧。阿桂的桂。”

她点点头，就绣了。

现在这只鞋在她手里，攥得紧紧的。

你想起那些日子，她每天都来，坐在你旁边絮叨。你绣血绣，她就看着，什么都不说。但她每次走的时候，都会把两个茶蛋塞进你怀里，说：“补补身子。”

你知道她看见了。她看见你扎破手指，看见你滴血进线里，看见你绣完一尺就得歇半天。她什么都不说，只是每天来，每天给你茶蛋。

现在她不来了。

你蹲下来，把那两个茶蛋放在灶台边上。那是你早上买的，还没来得及给她。

忽然，你想起了什么。

她前几天来找过你，说：“阿宁，别绣了。那东西伤身子。”

你没听。你说快了，快绣完了。

她看了你很久，然后走了。

现在你知道了。她那时候就在攒钱。她想去把那个贩子的钱还上，让你别绣了。

但她没来得及。

你把嘴捂住，不让自己哭出声。

【第三幕完】

请与搭档交流后，前往线索查探。`
                ]
            }
        },
        commonClues: [
            "【线索① 陈婆的住处】木匣子里有三张字条：“欠阿宁三十两”“给阿生做双鞋”“阿桂那丫头命苦”。另有一张药铺收据：三年陈艾，三十两，付清。日期是七天前。",
            "【线索② 茶摊现场】灶台有血迹，地上三个人的脚印：大人、小孩（阿生）、陌生人。钱罐里的钱少了大半。陈婆手里攥着一只新鞋，鞋面绣桂花。",
            "【线索③ 刘屠夫的证词】案发当天在酒馆喝醉，有不在场证明。陈婆欠他二两肉钱，但他没去讨。",
            "【线索④ 周老板娘证词】案发当天在绣坊未出门。阿宁赔了赎身的银子（三十两），陈婆几天前来问过阿宁的身体。",
            "【线索⑤ 货郎的证词】案发当天路过渡口，在茶摊歇脚吃了茶蛋。陈婆说“办成了一件大事”。货郎眼神躲闪，问及儿子支吾其词。",
            "【线索⑥ 阿生的证词】案发当天去过茶摊，试了新鞋（有点大）。走的时候看见货郎叔叔往茶摊走来。陈婆摸着他的头说：“好好念书，你姐就不用这么苦了。”"
        ],
        truth: `【案件真相】

凶手是：货郎。

作案过程：
案发那天上午，货郎路过渡口，在陈婆的茶摊歇脚。他吃完茶蛋，看见灶台边的钱罐子，起了贪念。他伸手抓钱时被陈婆发现。陈婆没有喊叫，反而叹着气说：“孩子，把钱放下，我不说。”货郎跪下哭诉儿子的困境，陈婆听完，从罐子里又抓了一把钱递给他：“拿去，这些你先用着。”推让之间，陈婆脚下一滑，后脑勺磕在灶台角上。

陈婆倒下时，手里还攥着那只准备给阿生的新鞋。货郎吓傻了，他把新鞋塞回陈婆手中，仓皇逃跑。

陈婆至死都攥着那只鞋。那不是罪证，是她还没来得及送出的温柔。

货郎不是恶人，只是个走投无路的父亲。陈婆的死，是一场善良对善良的误伤。`,

        // 阿桂视角的结局
        endingGui: `【江月不渡 · 结局 · 阿桂】

江边，夜。

你蹲在陈婆的茶摊废墟旁边，面前摆着两只碗。一碗茶蛋，阿生剥的，还热着。一碗药，阿宁熬的，还冒着气。

你说：“陈婆，茶蛋。阿生剥的。”

阿宁蹲在你旁边，把那碗药往前推了推：“陈婆，药。我熬的，不苦。”

风从江面上吹过来，吹得火盆里的纸灰打着旋儿往上飘。

你看着那些纸灰，忽然说：“那天早上，你上船的时候，攥着我的袖子。我以为你怕。”

阿宁说：“是怕。”

“怕什么？”

“怕你把我扔江里。”

你笑了一声，笑着笑着，眼泪就掉下来了。

阿宁伸手，握住你的袖子，攥得很紧，像那天早上一样紧。

“现在也怕。”

“怕什么？”

“怕你把我扔下。”

你没说话。你反手握住阿宁的手，那只手凉凉的，细细的骨节硌着你的掌心。

江面上，月亮碎成一片一片的，随着水波晃啊晃。

茶摊的废墟里，还有一只没烧完的鞋，小孩的，新做的，只有一只。

你忽然说：“阿宁。”

“嗯？”

“你绣血绣的时候，疼吗？”

阿宁沉默了一会儿，然后说：“疼。”

“那你为什么绣？”

阿宁没回答。她只是把我的手握得更紧。

过了一会儿，她说：“你呢？你撑船的时候，累吗？”

你说：“累。”

“那你为什么撑？”

你没回答。

你们就这么蹲着，手攥着手，看着江面上的月亮碎成一片一片的。

不知道过了多久，阿生跑过来，手里举着两只鞋：“姐！陈婆做的鞋！两只都在！”

你接过鞋，看了很久。

然后你站起来，拉着阿宁，往江边走了几步。

你把两只鞋并排放在江边的石头上，对着月亮，轻轻说：

“陈婆，阿生的鞋。两只都齐了。”

阿宁站在你旁边，把那碗药也放在石头边上。

“陈婆，药不苦。你尝尝。”

风停了。

月亮静静照着，照着两只鞋，一碗药，和两个蹲在江边的影子。

阿生蹲在你们旁边，小声问：“姐，陈婆能看见吗？”

你说：“能。”

“她高兴吗？”

阿宁说：“高兴。”

阿生点点头，把脑袋靠在阿桂肩膀上。

你们就这么蹲着，一直蹲到月亮偏西，蹲到江面上泛起鱼肚白。

谁也没说话。

但你知道，阿宁知道，阿生也知道——

陈婆在。

她一直在。`,

        // 阿宁视角的结局
        endingNing: `【江月不渡 · 结局 · 阿宁】

江边，夜。

你蹲在陈婆的茶摊废墟旁边，面前摆着两只碗。一碗茶蛋，阿生剥的，还热着。一碗药，你熬的，还冒着气。

阿桂把那碗茶蛋往前推了推：“陈婆，茶蛋。阿生剥的。”

你跟着把药碗也推过去：“陈婆，药。我熬的，不苦。”

风从江面上吹过来，吹得火盆里的纸灰打着旋儿往上飘。

你看着那些纸灰，忽然想起陈婆坐在你旁边絮叨的样子，想起她每天塞给你的茶蛋。那时候你绣血绣，手指上全是针眼，陈婆什么都不说，只是把蛋壳剥好，递到你嘴边。

阿桂忽然开口：“那天早上，你上船的时候，攥着我的袖子。我以为你怕。”

你一愣，然后轻声说：“是怕。”

“怕什么？”

“怕你把我扔江里。”你顿了顿，又说，“更怕你看出我在抖。”

阿桂笑了一声，笑着笑着，眼泪就掉下来了。

你伸出手，握住她的袖子，攥得很紧，像那天早上一样紧。那时候你刚绣完一夜的血绣，浑身都在抖，只有攥着她的袖子，才能站稳。

“现在也怕。”

“怕什么？”

“怕你把我扔下。”你说出这句话，忽然觉得胸口那个压了很久的石头，好像轻了一点。

阿桂反手握住你的手。她的手很暖，有撑船磨出的茧子，硌着你的掌心，却让你觉得安心。

江面上，月亮碎成一片一片的，随着水波晃啊晃。

茶摊的废墟里，还有一只没烧完的鞋，小孩的，新做的，只有一只。你看着那只鞋，想起陈婆问你绣什么花，你说绣桂花吧，阿桂的桂。

阿桂忽然问：“你绣血绣的时候，疼吗？”

你沉默了一会儿，然后说：“疼。”

“那你为什么绣？”

你没有回答。你没办法告诉她，你只是想让她不那么累，想让阿生能吃上药，想让她不再一个人撑船撑到天黑。这些话你从来不会说，就像她从来不会告诉你她撑船的时候有多累。

过了一会儿，你问：“你呢？你撑船的时候，累吗？”

她说：“累。”

“那你为什么撑？”

她也没回答。

你们就这么蹲着，手攥着手，看着江面上的月亮碎成一片一片的。

不知道过了多久，阿生跑过来，手里举着两只鞋：“姐！陈婆做的鞋！两只都在！”

你接过鞋，看了很久。鞋面上的桂花，是你让陈婆绣的。那时候你只是想，阿桂喜欢桂花，阿生穿上，就像阿桂陪着他一样。

阿桂站起来，拉着你往江边走了几步。她把两只鞋并排放在江边的石头上，对着月亮，轻轻说：

“陈婆，阿生的鞋。两只都齐了。”

你也蹲下来，把那碗药放在石头边上。

“陈婆，药不苦。你尝尝。”

风停了。

月亮静静照着，照着两只鞋，一碗药，和两个蹲在江边的影子。

阿生蹲在你们旁边，小声问：“姐，陈婆能看见吗？”

阿桂说：“能。”

“她高兴吗？”

你说：“高兴。”

阿生点点头，把脑袋靠在阿桂肩膀上。

你看着他们，忽然觉得，如果陈婆还在，大概也会这么蹲着，笑眯眯地看着。

你轻轻把头靠在阿桂的另一边肩膀上。

江风很凉，但她的肩膀很暖。

你们就这么蹲着，一直蹲到月亮偏西，蹲到江面上泛起鱼肚白。

谁也没说话。

但你知道，阿桂知道，阿生也知道——

陈婆在。

她一直在。`
    };

    // 全局变量
    let playerState = { 
        roleKey: '', 
        name: '',
        currentAct: 0   // 0,1,2 对应三幕
    };

    window.onload = () => {
        document.title = CONFIG.title + " · 双女主本";
        const select = document.getElementById('role-select');
        for (let key in CONFIG.roles) {
            let opt = document.createElement('option');
            opt.value = key;
            opt.innerText = CONFIG.roles[key].name;
            select.appendChild(opt);
        }
        createFlakes();
        setInterval(createFlakes, 20000);
    };

    function switchView(step) {
        document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('view' + step).classList.remove('hidden');
        document.getElementById('step' + step).classList.add('active');
        window.scrollTo(0,0);
    }

    function toStep1() { switchView(1); }

    function toStep2() {
        const name = document.getElementById('player-name').value;
        if(!name) { alert("请先输入你的名字！"); return; }
        playerState.name = name;
        playerState.roleKey = document.getElementById('role-select').value;
        const roleData = CONFIG.roles[playerState.roleKey];
        
        document.getElementById('display-role-name').innerText = roleData.name;
        document.getElementById('display-tasks').innerHTML = roleData.tasks;
        document.getElementById('display-secrets').innerHTML = roleData.secrets;
        
        // 重置为第一幕
        playerState.currentAct = 0;
        updateActDisplay();
        
        switchView(2);
    }

    function updateActDisplay() {
        const roleData = CONFIG.roles[playerState.roleKey];
        const act = playerState.currentAct;
        document.getElementById('display-script').innerText = roleData.scripts[act];
        
        // 更新幕数指示
        const actNames = ["第一幕 · 江边日常", "第二幕 · 暗流", "第三幕 · 惊雷"];
        document.getElementById('actIndicator').innerText = actNames[act] + " / 共三幕";
        
        // 控制按钮状态 (视觉上禁用)
        document.getElementById('prevActBtn').disabled = (act === 0);
        document.getElementById('nextActBtn').disabled = (act === 2);
        // 添加禁用样式
        document.getElementById('prevActBtn').style.opacity = (act === 0) ? "0.5" : "1";
        document.getElementById('nextActBtn').style.opacity = (act === 2) ? "0.5" : "1";
    }

    function prevAct() {
        if (playerState.currentAct > 0) {
            playerState.currentAct--;
            updateActDisplay();
        }
    }

    function nextAct() {
        if (playerState.currentAct < 2) {
            playerState.currentAct++;
            updateActDisplay();
        }
    }

    function toStep3() {
        // 填充公共线索
        const grid = document.getElementById('clue-grid');
        grid.innerHTML = '';
        CONFIG.commonClues.forEach((c, index) => {
            const div = document.createElement('div');
            div.className = 'clue-card';
            div.innerHTML = `<span class="clue-number">${index + 1}</span>${c}`;
            grid.appendChild(div);
        });
        switchView(3);
    }

    function toStep4() {
        if(confirm("进入最终裁决，请确认已讨论完毕。是否继续？")) {
            // 重置密码区域
            document.getElementById('password-section').classList.add('hidden');
            document.getElementById('truth-content').classList.add('hidden');
            document.getElementById('truth-password').value = '';
            switchView(4);
        }
    }

    function submitVote() {
        const murderer = document.getElementById('vote-murderer').value;
        if (!murderer) {
            alert("请先选择指认的真凶。");
            return;
        }
        // 显示密码解锁区域
        document.getElementById('password-section').classList.remove('hidden');
        // 隐藏之前真相
        document.getElementById('truth-content').classList.add('hidden');
    }

    function verifyPassword() {
        const pwd = document.getElementById('truth-password').value.trim().toLowerCase().replace(/\s+/g, '');
        const correct = CONFIG.password.toLowerCase().replace(/\s+/g, '');
        if (pwd === correct) {
            // 验证成功
            document.getElementById('password-section').classList.add('hidden');
            document.getElementById('truth-content').classList.remove('hidden');
            document.getElementById('display-truth').innerText = CONFIG.truth;
            
            // 根据角色显示对应结局
            const endingText = (playerState.roleKey === 'agui') ? CONFIG.endingGui : CONFIG.endingNing;
            document.getElementById('display-ending').innerText = endingText;
            
            document.getElementById('truth-content').scrollIntoView({ behavior: 'smooth' });
        } else {
            alert("❌ 密码不对……再想想陈婆最后留下的东西。");
            document.getElementById('truth-password').value = '';
            document.getElementById('truth-password').focus();
        }
    }
</script>
</body>
</html>

